





library(data.table)
library(dplyr)
library(readr)
library(lubridate)
library(data.table)
library(dplyr)
library(readr)
library(lubridate)
library(data.table)
library(dplyr)
library(readr)
library(ncdf4)
library(raster)
library(rgdal)
library(sf)
library(dplyr)
library(tidyr)
library(lubridate)
library(readr)
library(plm)
library(fixest)



communes_dates_1980_2022_temperature_final_mois<-fread("/données communes années/données mortalité temperature final mois/communes_dates_1980_2022_temperature_final_mois_humidity_rain_wind.csv")


#communes_dates_1980_2022_temperature_final_mois_grand_age<-fread("/données communes années/données mortalité temperature final mois new/communes_dates_1980_2022_temperature_final_mois_grand_age.csv")

#communes_dates_1980_2022_temperature_final_mois_grand_age<-communes_dates_1980_2022_temperature_final_mois_grand_age[,c("COM","mois","year","taux_mortalite_60_74","taux_mortalite_75_plus")]

#communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,communes_dates_1980_2022_temperature_final_mois_grand_age)

#rm(communes_dates_1980_2022_temperature_final_mois_grand_age)


commune_2022_dep <- read_csv("/commune_2022_dep.csv")
commune_2022_dep<-commune_2022_dep[,c("COM","DEP","REG")]
commune_2022_dep<-na.omit(commune_2022_dep)

communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,commune_2022_dep)
#test.na<-filter(communes_dates_1980_2022_temperature_final_mois, is.na(communes_dates_1980_2022_temperature_final_mois$DEP))
#0 na

#base_income_2001_2019 <- read_csv("/filosofi 2001_2020/filosofi_2001_2020_final/base_income_2001_2019")

#base_income_2001_2019_grand_age_60_74<- read_csv("/filosofi 2001_2020/filosofi_2001_2020_final/base_income_2001_2019_grand_age_60_74")
#base_income_2001_2019_grand_age_75_plus<- read_csv("/filosofi 2001_2020/filosofi_2001_2020_final/base_income_2001_2019_grand_age_75_plus")


#names(base_income_2001_2019_grand_age_60_74)[names(base_income_2001_2019_grand_age_60_74)=="mediane"]<-"mediane_60_74"
#names(base_income_2001_2019_grand_age_60_74)[names(base_income_2001_2019_grand_age_60_74)=="mediane_deciles"]<-"mediane_deciles_60_74"
#names(base_income_2001_2019_grand_age_60_74)[names(base_income_2001_2019_grand_age_60_74)=="mediane_percentiles"]<-"mediane_percentiles_60_74"

#base_income_2001_2019_grand_age_60_74<-base_income_2001_2019_grand_age_60_74[,-1]


#names(base_income_2001_2019_grand_age_75_plus)[names(base_income_2001_2019_grand_age_75_plus)=="mediane"]<-"mediane_75_plus"
#names(base_income_2001_2019_grand_age_75_plus)[names(base_income_2001_2019_grand_age_75_plus)=="mediane_deciles"]<-"mediane_deciles_75_plus"
#names(base_income_2001_2019_grand_age_75_plus)[names(base_income_2001_2019_grand_age_75_plus)=="mediane_percentiles"]<-"mediane_percentiles_75_plus"

#base_income_2001_2019_grand_age_75_plus<-base_income_2001_2019_grand_age_75_plus[,-1]



#communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,base_income_2001_2019)

#communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,base_income_2001_2019_grand_age_60_74)

#communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,base_income_2001_2019_grand_age_75_plus)





communes_dates_1980_2022_temperature_final_mois$taux_mortalite_total<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_total*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_80_plus<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_80_plus*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_65_69<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_65_69*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_60_64<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_60_64*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_70_74<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_70_74*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_75_79<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_75_79*10000


communes_dates_1980_2022_temperature_final_mois$taux_mortalite_40_59<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_40_59*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_20_39<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_20_39*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_10_19<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_10_19*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_0_9<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_0_9*10000


communes_dates_1980_2022_temperature_final_mois$taux_mortalite_60_74<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_60_74*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_75_plus<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_75_plus*10000



communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_num <- substr(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles, 2, nchar(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles))
communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_num)




communes_dates_1980_2022_temperature_final_mois$mediane_deciles_75_plus_num <- substr(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_75_plus, 2, nchar(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_75_plus))
communes_dates_1980_2022_temperature_final_mois$mediane_deciles_75_plus_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_75_plus_num)



communes_dates_1980_2022_temperature_final_mois$mediane_deciles_60_74_num <- substr(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_60_74, 2, nchar(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_60_74))
communes_dates_1980_2022_temperature_final_mois$mediane_deciles_60_74_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$mediane_deciles_60_74_num)



communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_60_74_num <- substr(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_60_74, 2, nchar(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_60_74))
communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_60_74_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_60_74_num)




communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_75_plus_num <- substr(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_75_plus, 2, nchar(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_75_plus))
communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_75_plus_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$mediane_percentiles_75_plus_num)






communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_60_74_num <- substr(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_60_74, 2, nchar(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_60_74))
communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_60_74_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_60_74_num)



communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_60_74_num <- substr(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_60_74, 2, nchar(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_60_74))
communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_60_74_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_60_74_num)



communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_75_plus_num <- substr(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_75_plus, 2, nchar(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_75_plus))
communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_75_plus_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$premier_decile_deciles_75_plus_num)



communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_75_plus_num <- substr(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_75_plus, 2, nchar(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_75_plus))
communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_75_plus_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$neuvieme_decile_deciles_75_plus_num)



communes_dates_1980_2022_temperature_final_mois$premier_decile_percentiles_75_plus_num <- substr(communes_dates_1980_2022_temperature_final_mois$premier_decile_percentiles_75_plus, 2, nchar(communes_dates_1980_2022_temperature_final_mois$premier_decile_percentiles_75_plus))
communes_dates_1980_2022_temperature_final_mois$premier_decile_percentiles_75_plus_num<-as.numeric(communes_dates_1980_2022_temperature_final_mois$premier_decile_percentiles_75_plus_num)




communes_dates_1980_2022_temperature_final_mois$part_agriculteur[communes_dates_1980_2022_temperature_final_mois$part_agriculteur<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_artisan_commercant_chef_entreprise[communes_dates_1980_2022_temperature_final_mois$part_artisan_commercant_chef_entreprise<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_cadre[communes_dates_1980_2022_temperature_final_mois$part_cadre<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_profession_intermediaire[communes_dates_1980_2022_temperature_final_mois$part_profession_intermediaire<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_employe[communes_dates_1980_2022_temperature_final_mois$part_employe<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_ouvrier[communes_dates_1980_2022_temperature_final_mois$part_ouvrier<0]<-0
communes_dates_1980_2022_temperature_final_mois$part_chomage[communes_dates_1980_2022_temperature_final_mois$part_chomage<0]<-0



communes_dates_1980_2022_temperature_final_mois$taux_mortalite_homme<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_homme*10000
communes_dates_1980_2022_temperature_final_mois$taux_mortalite_femme<-communes_dates_1980_2022_temperature_final_mois$taux_mortalite_femme*10000







canicule_data<-fread("/données canicules/communes_dates_1980_2022_temperature_final_mois_canicule_final.csv")


communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,canicule_data)



base_densite_1980_2019 <- read_csv("/donnees densite pop observatoire/base_densite_1980_2019")

base_densite_1980_2019<-base_densite_1980_2019[,c(-1)]

communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,base_densite_1980_2019)






temperature_max<-fread("/données communes années/données mortalité temperature final mois new/donnee_temperature_max.csv")


communes_dates_1980_2022_temperature_final_mois<-left_join(communes_dates_1980_2022_temperature_final_mois,temperature_max)


rm(canicule_data,temperature_max,base_income_2001_2019,base_densite_1980_2019)






communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_35_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_30_tempmax_part + communes_dates_1980_2022_temperature_final_mois$temp_max_bin_30_35_tempmax_part


communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_35_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_35_tempmax_part*30



communes_dates_1980_2022_temperature_final_mois$temp_max_bin_plus_35_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_plus_35_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_inférieur_moins_10_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_inférieur_moins_10_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_moins10_0_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_moins10_0_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_0_10_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_0_10_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_10_15_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_10_15_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_15_20_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_15_20_tempmax_part*30


communes_dates_1980_2022_temperature_final_mois$temp_max_bin_20_25_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_20_25_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_30_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_25_30_tempmax_part*30

communes_dates_1980_2022_temperature_final_mois$temp_max_bin_30_35_tempmax_part<-communes_dates_1980_2022_temperature_final_mois$temp_max_bin_30_35_tempmax_part*30


communes_dates_1980_2022_temperature_final_mois$below_minus_20<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_inferieu_moins_20_part*30

communes_dates_1980_2022_temperature_final_mois$minus_20_to_minus_15<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_moins_20_moins_15_part*30

communes_dates_1980_2022_temperature_final_mois$minus_15_to_minus_10<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_moins_15_moins_10_part*30

communes_dates_1980_2022_temperature_final_mois$minus_10_to_minus_5<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_moins_10_moins_5_part*30

communes_dates_1980_2022_temperature_final_mois$minus_5_to_0<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_moins_5_0_part*30

communes_dates_1980_2022_temperature_final_mois$zero_to_5<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_0_5_part*30

communes_dates_1980_2022_temperature_final_mois$five_to_10<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_5_10_part*30

communes_dates_1980_2022_temperature_final_mois$ten_to_15<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_10_15_part*30

communes_dates_1980_2022_temperature_final_mois$fifteen_to_20<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_15_20_part*30

communes_dates_1980_2022_temperature_final_mois$twenty_to_25<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_20_25_part*30

communes_dates_1980_2022_temperature_final_mois$twentyfive_to_28<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_25_28_part*30

communes_dates_1980_2022_temperature_final_mois$twenty_eight_to_30<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_28_30_part*30

communes_dates_1980_2022_temperature_final_mois$above_30<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_superieur_30_part*30


communes_dates_1980_2022_temperature_final_mois$temperature_bin_inf20_moins15<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_inferieu_moins_20_part+ communes_dates_1980_2022_temperature_final_mois$temperature_bin_moins_20_moins_15_part

communes_dates_1980_2022_temperature_final_mois$below_minus_20_to_minus_15<-communes_dates_1980_2022_temperature_final_mois$temperature_bin_inf20_moins15*30





rm(base_income_2001_2019_grand_age_60_74,base_income_2001_2019_grand_age_60_74_neuvieme_decile,base_income_2001_2019_grand_age_60_74_premier_decile,base_income_2001_2019_grand_age_75_plus,base_income_2001_2019_grand_age_75_plus_neuvieme_decile,base_income_2001_2019_grand_age_75_plus_premier_decile,commune_2022_dep)  












